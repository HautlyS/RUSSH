import{x as he,k as $,c as B,a as we,d as N,w as se,B as l,N as de,L as T,E as e,b as D,K as v,F as b,J as P,O as W,P as A,_ as Ce,G as R,H as E,$ as ve,Q as z,D as j,g as G,e as a,I as oe,Y as $e,o as _e,j as Te,f as Le,A as Se}from"./vue-vendor-DDhLe2KT.js";import{e as Be,p as ue,l as ge,k as Pe,a as Ue,i as je}from"./index-Bx4hJxvb.js";import{invoke as te}from"@tauri-apps/api/core";import{au as be,av as ae,X as ne,aw as fe,ax as le,ay as ye,az as Ie,aA as De,aB as Re,a8 as ie,J as pe,$ as Me,R as Ve,g as Fe,_ as We,aC as ze,aD as Oe,a0 as Ae,Y as Ee,V as Ne,aE as re,aF as me,o as ke,O as Ke,a6 as qe,I as He,m as Je,U as Ge,W as Qe,b as Xe,at as Ye}from"./ui-vendor-B_QD22ki.js";import{L as Ze}from"./Lightning-C3IqH1GN.js";const xe=he("p2pTerminal",()=>{const t=$(new Map),p=$(null),c=$(new Map),u=$(new Map),k=B(()=>p.value&&t.value.get(p.value)||null),w=B(()=>Array.from(t.value.values()).sort((r,o)=>o.lastActivity-r.lastActivity)),x=B(()=>Array.from(t.value.values()).reduce((r,o)=>r+o.unreadCount,0));function L(r){const o=t.value.get(r.id);if(o)return o;const n={peerId:r.id,peerName:r.name,blocks:[],unreadCount:0,lastActivity:Date.now(),isTyping:!1};return t.value.set(r.id,n),n}function I(r){if(p.value=r,r){const o=t.value.get(r);o&&(o.unreadCount=0)}}function F(r,o){let n=t.value.get(r);n||(n={peerId:r,blocks:[],unreadCount:0,lastActivity:Date.now(),isTyping:!1},t.value.set(r,n)),n.blocks.push(o),n.lastActivity=o.timestamp,p.value!==r&&!o.isLocal&&n.unreadCount++}function V(r,o,n){const f=t.value.get(r);if(!f)return;const y=f.blocks.findIndex(U=>U.id===o);y!==-1&&(f.blocks[y]={...f.blocks[y],...n})}function m(r,o,n){const f=t.value.get(r);if(!f)return;const y=f.blocks.find(U=>U.id===o);y&&y.type==="widget"&&(y.responses||(y.responses=[]),y.responses.push(n))}function S(r,o){const n=t.value.get(r);n&&(n.isTyping=o)}function M(r){const o=t.value.get(r);o&&(o.blocks.forEach(n=>{n.type==="file"&&n.previewUrl&&URL.revokeObjectURL(n.previewUrl)}),o.blocks=[],o.unreadCount=0)}function i(r){const o=t.value.get(r);o&&o.blocks.forEach(n=>{n.type==="file"&&n.previewUrl&&URL.revokeObjectURL(n.previewUrl)}),t.value.delete(r),p.value===r&&(p.value=null)}function h(r){u.value.set(r.id,r)}function _(r){u.value.delete(r)}return{conversations:t,activeConversationId:p,typingPeers:c,pendingMessages:u,activeConversation:k,conversationList:w,totalUnread:x,createConversation:L,setActiveConversation:I,addBlock:F,updateBlock:V,addWidgetResponse:m,setTypingIndicator:S,clearConversation:M,removeConversation:i,addPendingMessage:h,removePendingMessage:_}});function K(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function et(){const t=xe(),p=Be(),c=$(!1),u=$("");let k=null,w=null,x=null;async function L(o){u.value=o,k=await ge("p2p-message",n=>{I(n.payload.peerId,n.payload.message)}),w=await ge("p2p-typing",n=>{t.setTypingIndicator(n.payload.peerId,n.payload.isTyping)}),c.value=!0}function I(o,n){switch(n.type){case"block":const f=n.payload;f.isLocal=!1,t.addBlock(o,f);break;case"typing":break;case"ack":t.removePendingMessage(n.id);break;case"widget-response":const{blockId:y,response:U}=n.payload;t.addWidgetResponse(o,y,U);break}}async function F(o,n,f="plain"){const y={id:K(),type:"text",senderId:u.value,timestamp:Date.now(),isLocal:!0,content:n,format:f};t.addBlock(o,y),await i(o,y)}async function V(o,n,f,y){const U={id:K(),type:"code",senderId:u.value,timestamp:Date.now(),isLocal:!0,content:n,language:f,filename:y,showLineNumbers:!0};t.addBlock(o,U),await i(o,U)}async function m(o,n){const f={id:K(),type:"file",senderId:u.value,timestamp:Date.now(),isLocal:!0,filename:n.name,size:n.size,mimeType:n.type,transferStatus:"pending",transferProgress:0};let y;n.type.startsWith("image/")&&(y=URL.createObjectURL(n),f.previewUrl=y),t.addBlock(o,f);try{const U=await n.arrayBuffer();f.data=U,f.transferStatus="transferring",t.updateBlock(o,f.id,{transferStatus:"transferring"}),await i(o,f),t.updateBlock(o,f.id,{transferStatus:"completed",transferProgress:100})}catch(U){throw t.updateBlock(o,f.id,{transferStatus:"failed"}),y&&URL.revokeObjectURL(y),U}}async function S(o,n,f){const y={id:K(),type:"widget",senderId:u.value,timestamp:Date.now(),isLocal:!0,widgetType:n,config:f,responses:[]};t.addBlock(o,y),await i(o,y)}async function M(o,n,f="info"){const y={id:K(),type:"system",senderId:u.value,timestamp:Date.now(),isLocal:!0,message:n,level:f};t.addBlock(o,y)}async function i(o,n){const f={id:K(),type:"block",payload:n,timestamp:Date.now()};t.addPendingMessage(f);try{await te("p2p_send_message",{peerId:o,message:JSON.stringify(f)})}catch(y){const U=ue(y);throw p.error("Send Failed",U.message),t.removePendingMessage(f.id),y}}async function h(o,n){x&&clearTimeout(x),n&&(x=setTimeout(()=>{h(o,!1)},3e3));try{await te("p2p_send_typing",{peerId:o,isTyping:n})}catch(f){console.warn("Failed to send typing indicator:",f)}}async function _(o,n,f){const y={responderId:u.value,timestamp:Date.now(),value:f},U={id:K(),type:"widget-response",payload:{blockId:n,response:y},timestamp:Date.now()};try{await te("p2p_send_message",{peerId:o,message:JSON.stringify(U)}),t.addWidgetResponse(o,n,y)}catch(O){const H=ue(O);throw p.error("Response Failed",H.message),O}}function r(){k?.(),w?.(),x&&clearTimeout(x),c.value=!1}return we(r),{isConnected:c,localNodeId:u,initialize:L,sendTextBlock:F,sendCodeBlock:V,sendFileBlock:m,sendWidgetBlock:S,sendSystemBlock:M,sendTypingIndicator:h,sendWidgetResponse:_,dispose:r}}const tt={key:0,class:"flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700"},at={class:"flex items-center gap-2 text-sm"},st={class:"font-medium text-gray-700 dark:text-gray-300"},ot={key:1,class:"absolute bottom-full left-4 mb-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10"},nt={key:2,class:"p-4"},lt={class:"flex items-end gap-2"},rt={class:"flex-1 relative"},it={class:"flex items-center gap-1"},ct=["disabled"],dt={key:3,class:"p-4 space-y-3"},ut={class:"flex items-center gap-2"},gt=["value"],bt=["onKeydown"],ft={class:"flex justify-end"},yt=["disabled"],vt={key:4,class:"p-4 space-y-4"},pt={class:"flex gap-2 overflow-x-auto pb-2"},mt=["onClick"],kt={class:"space-y-2"},xt=["onUpdate:modelValue","placeholder"],ht=["onClick"],wt={class:"flex justify-end"},Ct=["disabled"],$t=N({__name:"BlockComposer",emits:["sendText","sendCode","sendFile","sendWidget","typing"],setup(t,{emit:p}){const c=p,u=$("text"),k=$(""),w=$(""),x=$("javascript"),L=$(""),I=$(!1),F=$(!1),V=$(),m=$("button"),S=$(""),M=$(""),i=$(""),h=$(["",""]),_=$(""),r=["javascript","typescript","python","rust","go","java","cpp","c","html","css","json","yaml","bash","sql"],o=[{type:"button",label:"Button",icon:ye},{type:"input",label:"Input",icon:Ie},{type:"poll",label:"Poll",icon:De},{type:"progress",label:"Progress",icon:Re},{type:"confirm",label:"Confirm",icon:ye}],n=B(()=>{switch(u.value){case"text":return k.value.trim().length>0;case"code":return w.value.trim().length>0;case"widget":return f.value;default:return!1}}),f=B(()=>{switch(m.value){case"button":return S.value.trim()&&M.value.trim();case"input":return S.value.trim();case"poll":return i.value.trim()&&h.value.filter(d=>d.trim()).length>=2;case"confirm":return _.value.trim();case"progress":return S.value.trim();default:return!1}});se(k,d=>{d==="/"?I.value=!0:d.startsWith("/")||(I.value=!1),c("typing",d.length>0)}),se(k,d=>{u.value==="text"&&y(d)});function y(d){return[/^(import|export|const|let|var|function|class|def|fn|pub|async)\s/m,/[{}\[\]();]/,/^\s{2,}/m].some(g=>g.test(d))&&d.split(`
`).length>2}function U(d){switch(I.value=!1,k.value="",d){case"code":u.value="code";break;case"file":V.value?.click();break;case"widget":u.value="widget",F.value=!0;break}}function O(){if(n.value){switch(u.value){case"text":const d=/[*_`\[\]]/.test(k.value);c("sendText",k.value,d?"markdown":"plain"),k.value="";break;case"code":c("sendCode",w.value,x.value,L.value||void 0),w.value="",L.value="",u.value="text";break;case"widget":H();break}c("typing",!1)}}function H(){let d;switch(m.value){case"button":d={type:"button",label:S.value,action:M.value,variant:"primary"};break;case"input":d={type:"input",label:S.value,placeholder:"Enter your response..."};break;case"poll":d={type:"poll",question:i.value,options:h.value.filter(s=>s.trim())};break;case"progress":d={type:"progress",label:S.value,value:0,max:100};break;case"confirm":d={type:"confirm",message:_.value};break;default:return}c("sendWidget",m.value,d),J(),u.value="text"}function J(){S.value="",M.value="",i.value="",h.value=["",""],_.value="",F.value=!1}function Q(d){const s=d.target,g=s.files?.[0];g&&(c("sendFile",g),s.value="")}function X(d){d.preventDefault();const s=d.dataTransfer?.files[0];s&&c("sendFile",s)}function Y(d){d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),O())}function Z(){h.value.push("")}function ee(d){h.value.length>2&&h.value.splice(d,1)}function C(){u.value="text",J()}return(d,s)=>(a(),l("div",{class:"block-composer border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",onDrop:X,onDragover:s[14]||(s[14]=de(()=>{},["prevent"]))},[u.value!=="text"?(a(),l("div",tt,[e("div",at,[u.value==="code"?(a(),D(v(be),{key:0,class:"w-4 h-4 text-blue-500"})):T("",!0),u.value==="widget"?(a(),D(v(ae),{key:1,class:"w-4 h-4 text-purple-500"})):T("",!0),e("span",st,b(u.value==="code"?"Code Block":"Widget Builder"),1)]),e("button",{onClick:C,class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[P(v(ne),{class:"w-4 h-4"})])])):T("",!0),I.value?(a(),l("div",ot,[s[18]||(s[18]=e("div",{class:"p-2 text-xs text-gray-500 border-b border-gray-200 dark:border-gray-700"}," Commands ",-1)),e("button",{onClick:s[0]||(s[0]=g=>U("code")),class:"w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-left"},[P(v(be),{class:"w-4 h-4 text-blue-500"}),s[15]||(s[15]=e("div",null,[e("p",{class:"text-sm font-medium text-gray-900 dark:text-white"},"Code Block"),e("p",{class:"text-xs text-gray-500"},"Share syntax-highlighted code")],-1))]),e("button",{onClick:s[1]||(s[1]=g=>U("file")),class:"w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-left"},[P(v(fe),{class:"w-4 h-4 text-green-500"}),s[16]||(s[16]=e("div",null,[e("p",{class:"text-sm font-medium text-gray-900 dark:text-white"},"File"),e("p",{class:"text-xs text-gray-500"},"Upload and share a file")],-1))]),e("button",{onClick:s[2]||(s[2]=g=>U("widget")),class:"w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-left"},[P(v(ae),{class:"w-4 h-4 text-purple-500"}),s[17]||(s[17]=e("div",null,[e("p",{class:"text-sm font-medium text-gray-900 dark:text-white"},"Widget"),e("p",{class:"text-xs text-gray-500"},"Create interactive elements")],-1))])])):T("",!0),u.value==="text"?(a(),l("div",nt,[e("div",lt,[e("div",rt,[W(e("textarea",{ref:"textareaRef","onUpdate:modelValue":s[3]||(s[3]=g=>k.value=g),placeholder:"Type a message... (/ for commands)",rows:"1",class:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 rounded-2xl resize-none text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeydown:Y},null,544),[[A,k.value]])]),e("div",it,[e("button",{onClick:s[4]||(s[4]=g=>V.value?.click()),class:"p-3 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"Attach file"},[P(v(fe),{class:"w-5 h-5"})]),e("button",{onClick:O,disabled:!n.value,class:"p-3 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white rounded-full transition-colors"},[P(v(le),{class:"w-5 h-5"})],8,ct)])])])):u.value==="code"?(a(),l("div",dt,[e("div",ut,[W(e("select",{"onUpdate:modelValue":s[5]||(s[5]=g=>x.value=g),class:"px-3 py-1.5 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm text-gray-900 dark:text-white border-none focus:ring-2 focus:ring-blue-500"},[(a(),l(R,null,E(r,g=>e("option",{key:g,value:g},b(g),9,gt)),64))],512),[[Ce,x.value]]),W(e("input",{"onUpdate:modelValue":s[6]||(s[6]=g=>L.value=g),placeholder:"filename (optional)",class:"flex-1 px-3 py-1.5 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[A,L.value]])]),W(e("textarea",{"onUpdate:modelValue":s[7]||(s[7]=g=>w.value=g),placeholder:"Paste or type your code here...",rows:"6",class:"w-full px-4 py-3 bg-gray-900 rounded-lg font-mono text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",onKeydown:ve(de(O,["ctrl"]),["enter"])},null,40,bt),[[A,w.value]]),e("div",ft,[e("button",{onClick:O,disabled:!n.value,class:"flex items-center gap-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white rounded-lg transition-colors"},[P(v(le),{class:"w-4 h-4"}),s[19]||(s[19]=z(" Send Code ",-1))],8,yt)])])):u.value==="widget"?(a(),l("div",vt,[e("div",pt,[(a(),l(R,null,E(o,g=>e("button",{key:g.type,onClick:q=>m.value=g.type,class:j(["flex items-center gap-2 px-3 py-2 rounded-lg text-sm whitespace-nowrap transition-colors",m.value===g.type?"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},[(a(),D(G(g.icon),{class:"w-4 h-4"})),z(" "+b(g.label),1)],10,mt)),64))]),m.value==="button"?(a(),l(R,{key:0},[W(e("input",{"onUpdate:modelValue":s[8]||(s[8]=g=>S.value=g),placeholder:"Button label",class:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[A,S.value]]),W(e("input",{"onUpdate:modelValue":s[9]||(s[9]=g=>M.value=g),placeholder:"Action identifier",class:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[A,M.value]])],64)):m.value==="input"?W((a(),l("input",{key:1,"onUpdate:modelValue":s[10]||(s[10]=g=>S.value=g),placeholder:"Input label / question",class:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512)),[[A,S.value]]):m.value==="poll"?(a(),l(R,{key:2},[W(e("input",{"onUpdate:modelValue":s[11]||(s[11]=g=>i.value=g),placeholder:"Poll question",class:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512),[[A,i.value]]),e("div",kt,[(a(!0),l(R,null,E(h.value,(g,q)=>(a(),l("div",{key:q,class:"flex items-center gap-2"},[W(e("input",{"onUpdate:modelValue":ce=>h.value[q]=ce,placeholder:`Option ${q+1}`,class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,8,xt),[[A,h.value[q]]]),h.value.length>2?(a(),l("button",{key:0,onClick:ce=>ee(q),class:"p-2 text-gray-400 hover:text-red-500"},[P(v(ne),{class:"w-4 h-4"})],8,ht)):T("",!0)]))),128)),e("button",{onClick:Z,class:"text-sm text-purple-500 hover:text-purple-600"}," + Add option ")])],64)):m.value==="confirm"?W((a(),l("input",{key:3,"onUpdate:modelValue":s[12]||(s[12]=g=>_.value=g),placeholder:"Confirmation message",class:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512)),[[A,_.value]]):m.value==="progress"?W((a(),l("input",{key:4,"onUpdate:modelValue":s[13]||(s[13]=g=>S.value=g),placeholder:"Progress label",class:"w-full px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"},null,512)),[[A,S.value]]):T("",!0),e("div",wt,[e("button",{onClick:O,disabled:!n.value,class:"flex items-center gap-2 px-4 py-2 bg-purple-500 hover:bg-purple-600 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white rounded-lg transition-colors"},[P(v(ae),{class:"w-4 h-4"}),s[20]||(s[20]=z(" Send Widget ",-1))],8,Ct)])])):T("",!0),e("input",{ref_key:"fileInputRef",ref:V,type:"file",class:"hidden",onChange:Q},null,544)],32))}}),_t=["innerHTML"],Tt={key:1,class:"whitespace-pre-wrap break-words"},Lt={class:"text-xs text-gray-500"},St=N({__name:"TextBlockView",props:{block:{}},setup(t){const p=t,c=$(!1),u=B(()=>new Date(p.block.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),k=B(()=>{if(p.block.format!=="markdown")return p.block.content;let x=p.block.content;return x=x.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),x=x.replace(/\*(.*?)\*/g,"<em>$1</em>"),x=x.replace(/`(.*?)`/g,'<code class="px-1 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-sm">$1</code>'),x=x.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" class="text-blue-500 hover:underline" target="_blank">$1</a>'),x});async function w(){await navigator.clipboard.writeText(p.block.content),c.value=!0,setTimeout(()=>c.value=!1,2e3)}return(x,L)=>(a(),l("div",{class:j(["text-block group relative",t.block.isLocal?"ml-auto":"mr-auto"])},[e("div",{class:j(["max-w-md px-4 py-2 rounded-2xl",t.block.isLocal?"bg-blue-500 text-white rounded-br-md":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-md"])},[t.block.format==="markdown"?(a(),l("p",{key:0,innerHTML:k.value,class:"whitespace-pre-wrap break-words"},null,8,_t)):(a(),l("p",Tt,b(t.block.content),1))],2),e("div",{class:j(["flex items-center gap-2 mt-1 opacity-0 group-hover:opacity-100 transition-opacity",t.block.isLocal?"justify-end":"justify-start"])},[e("span",Lt,b(u.value),1),e("button",{onClick:w,class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",title:"Copy"},[c.value?(a(),D(v(ie),{key:0,class:"w-3 h-3 text-green-500"})):(a(),D(v(pe),{key:1,class:"w-3 h-3"}))])],2)],2))}}),Bt={class:"bg-gray-900 rounded-lg overflow-hidden border border-gray-700"},Pt={class:"flex items-center justify-between px-3 py-2 bg-gray-800 border-b border-gray-700"},Ut={class:"flex items-center gap-2"},jt={key:0,class:"text-xs text-gray-400"},It={class:"relative"},Dt={class:"p-4 overflow-x-auto text-sm"},Rt={class:"inline-block w-8 text-gray-500 text-right mr-4 select-none"},Mt={key:0,class:"absolute bottom-0 left-0 right-0 flex justify-center pb-2 pt-8 bg-gradient-to-t from-gray-900 to-transparent"},Vt=N({__name:"CodeBlockView",props:{block:{}},setup(t){const p=t,c=$(!1),u=$(!1),k=B(()=>p.block.content.split(`
`)),w=B(()=>k.value.length>20),x=B(()=>!w.value||u.value?p.block.content:k.value.slice(0,20).join(`
`)),L={javascript:"bg-yellow-500",typescript:"bg-blue-500",python:"bg-green-500",rust:"bg-orange-500",go:"bg-cyan-500",java:"bg-red-500",cpp:"bg-purple-500",c:"bg-gray-500",html:"bg-orange-400",css:"bg-blue-400",json:"bg-gray-400",yaml:"bg-pink-500",bash:"bg-green-600",sql:"bg-indigo-500"},I=B(()=>L[p.block.language.toLowerCase()]||"bg-gray-500"),F=B(()=>new Date(p.block.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));async function V(){await navigator.clipboard.writeText(p.block.content),c.value=!0,setTimeout(()=>c.value=!1,2e3)}return(m,S)=>(a(),l("div",{class:j(["code-block w-full max-w-2xl",t.block.isLocal?"ml-auto":"mr-auto"])},[e("div",Bt,[e("div",Pt,[e("div",Ut,[P(v(Me),{class:"w-4 h-4 text-gray-400"}),e("span",{class:j(["px-2 py-0.5 text-xs font-medium text-white rounded",I.value])},b(t.block.language),3),t.block.filename?(a(),l("span",jt,b(t.block.filename),1)):T("",!0)]),e("button",{onClick:V,class:"flex items-center gap-1 px-2 py-1 text-xs text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors"},[c.value?(a(),D(v(ie),{key:0,class:"w-3 h-3 text-green-500"})):(a(),D(v(pe),{key:1,class:"w-3 h-3"})),z(" "+b(c.value?"Copied!":"Copy"),1)])]),e("div",It,[e("pre",Dt,[e("code",{class:j(["text-gray-100 font-mono",t.block.showLineNumbers?"block":""])},[t.block.showLineNumbers?(a(!0),l(R,{key:0},E(x.value.split(`
`),(M,i)=>(a(),l("span",{key:i,class:"block"},[e("span",Rt,b(i+1),1),z(b(M),1)]))),128)):(a(),l(R,{key:1},[z(b(x.value),1)],64))],2)]),w.value?(a(),l("div",Mt,[e("button",{onClick:S[0]||(S[0]=M=>u.value=!u.value),class:"flex items-center gap-1 px-3 py-1 text-xs text-gray-400 hover:text-white bg-gray-800 hover:bg-gray-700 rounded-full transition-colors"},[u.value?(a(),D(v(Ve),{key:0,class:"w-3 h-3"})):(a(),D(v(Fe),{key:1,class:"w-3 h-3"})),z(" "+b(u.value?"Collapse":`Show ${k.value.length-20} more lines`),1)])])):T("",!0)])]),e("div",{class:j(["mt-1 text-xs text-gray-500",t.block.isLocal?"text-right":"text-left"])},b(F.value),3)],2))}}),Ft={key:0,class:"relative aspect-video bg-gray-200 dark:bg-gray-700"},Wt=["src","alt"],zt={key:0,class:"absolute inset-0 bg-black/50 flex items-center justify-center"},Ot={class:"text-white text-center"},At={class:"text-sm"},Et={class:"p-3 flex items-center gap-3"},Nt={class:"flex-1 min-w-0"},Kt={class:"font-medium text-sm text-gray-900 dark:text-white truncate"},qt={class:"text-xs text-gray-500 dark:text-gray-400"},Ht={class:"flex items-center gap-2"},Jt={key:1,class:"px-3 pb-3"},Gt={class:"h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},Qt=N({__name:"FileBlockView",props:{block:{}},emits:["download","retry"],setup(t,{emit:p}){const c=t,u=p,k=B(()=>{const m=c.block.size;return m<1024?`${m} B`:m<1024*1024?`${(m/1024).toFixed(1)} KB`:m<1024*1024*1024?`${(m/(1024*1024)).toFixed(1)} MB`:`${(m/(1024*1024*1024)).toFixed(1)} GB`}),w=B(()=>new Date(c.block.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),x=B(()=>{const m=c.block.mimeType;return m.startsWith("image/")?We:m.startsWith("video/")?ze:m.startsWith("audio/")?Oe:m.startsWith("text/")?Ae:m.includes("zip")||m.includes("tar")||m.includes("rar")?Ee:Ne}),L=B(()=>{switch(c.block.transferStatus){case"completed":return ke;case"failed":return me;case"transferring":return re;default:return null}}),I=B(()=>{switch(c.block.transferStatus){case"completed":return"text-green-500";case"failed":return"text-red-500";case"transferring":return"text-blue-500";default:return"text-gray-400"}});function F(){u("download",c.block)}function V(){u("retry",c.block)}return(m,S)=>(a(),l("div",{class:j(["file-block w-full max-w-sm",t.block.isLocal?"ml-auto":"mr-auto"])},[e("div",{class:j(["rounded-lg overflow-hidden border",t.block.isLocal?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700"])},[t.block.previewUrl&&t.block.mimeType.startsWith("image/")?(a(),l("div",Ft,[e("img",{src:t.block.previewUrl,alt:t.block.filename,class:"w-full h-full object-cover"},null,8,Wt),t.block.transferStatus==="transferring"?(a(),l("div",zt,[e("div",Ot,[P(v(re),{class:"w-8 h-8 animate-spin mx-auto mb-2"}),e("span",At,b(t.block.transferProgress)+"%",1)])])):T("",!0)])):T("",!0),e("div",Et,[e("div",{class:j(["w-10 h-10 rounded-lg flex items-center justify-center",t.block.isLocal?"bg-blue-100 dark:bg-blue-800":"bg-gray-200 dark:bg-gray-700"])},[(a(),D(G(x.value),{class:j(["w-5 h-5",t.block.isLocal?"text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-400"])},null,8,["class"]))],2),e("div",Nt,[e("p",Kt,b(t.block.filename),1),e("p",qt,b(k.value),1)]),e("div",Ht,[L.value&&t.block.transferStatus!=="pending"?(a(),D(G(L.value),{key:0,class:j(["w-5 h-5",[I.value,t.block.transferStatus==="transferring"?"animate-spin":""]])},null,8,["class"])):T("",!0),!t.block.isLocal&&t.block.transferStatus==="completed"?(a(),l("button",{key:1,onClick:F,class:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors",title:"Download"},[P(v(Ke),{class:"w-4 h-4"})])):T("",!0),t.block.transferStatus==="failed"?(a(),l("button",{key:2,onClick:V,class:"p-2 text-gray-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-900/30 rounded-lg transition-colors",title:"Retry"},[P(v(qe),{class:"w-4 h-4"})])):T("",!0)])]),t.block.transferStatus==="transferring"?(a(),l("div",Jt,[e("div",Gt,[e("div",{class:"h-full bg-blue-500 transition-all duration-300",style:oe({width:`${t.block.transferProgress||0}%`})},null,4)])])):T("",!0)],2),e("div",{class:j(["mt-1 text-xs text-gray-500",t.block.isLocal?"text-right":"text-left"])},b(w.value),3)],2))}}),Xt=["disabled"],Yt={key:0,class:"mt-2 text-xs text-gray-500 text-center"},Zt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},ea={class:"flex gap-2"},ta=["type","placeholder","disabled"],aa=["disabled"],sa={key:0,class:"mt-3 space-y-1"},oa={class:"font-medium"},na={class:"font-medium text-gray-900 dark:text-white mb-3"},la={class:"space-y-2"},ra=["onClick","disabled"],ia={class:"relative z-10 flex items-center justify-between"},ca={class:"text-sm text-gray-900 dark:text-white"},da={key:0,class:"text-xs text-gray-500"},ua={class:"flex items-center justify-between mb-2"},ga={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ba={class:"text-sm text-gray-500"},fa={class:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},ya={class:"text-sm text-gray-700 dark:text-gray-300 mb-3"},va={key:0,class:"flex gap-2"},pa={key:1,class:"text-sm text-center text-gray-500"},ma=N({__name:"WidgetBlockView",props:{block:{},localNodeId:{}},emits:["respond"],setup(t,{emit:p}){const c=t,u=p,k=$(""),w=$([]),x=B(()=>new Date(c.block.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),L=B(()=>c.block.responses?.some(i=>i.responderId===c.localNodeId)),I=B(()=>{if(c.block.config.type!=="poll")return[];const i=new Map;c.block.responses?.forEach(_=>{_.value.forEach(o=>i.set(o,(i.get(o)||0)+1))});const h=c.block.responses?.length||0;return c.block.config.options.map((_,r)=>({option:_,count:i.get(r)||0,percentage:h>0?(i.get(r)||0)/h*100:0}))});function F(i){u("respond",c.block.id,{action:i})}function V(){k.value.trim()&&(u("respond",c.block.id,k.value),k.value="")}function m(){w.value.length>0&&u("respond",c.block.id,w.value)}function S(i){if(c.block.config.type==="poll")if(c.block.config.allowMultiple){const h=w.value.indexOf(i);h>-1?w.value.splice(h,1):w.value.push(i)}else w.value=[i]}function M(i){u("respond",c.block.id,i)}return(i,h)=>(a(),l("div",{class:j(["widget-block w-full max-w-sm",t.block.isLocal?"ml-auto":"mr-auto"])},[e("div",{class:j(["rounded-lg overflow-hidden border p-4",t.block.isLocal?"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800":"bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700"])},[t.block.config.type==="button"?(a(),l(R,{key:0},[e("button",{onClick:h[0]||(h[0]=_=>F(t.block.config.action)),disabled:L.value,class:j(["w-full px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",{"bg-blue-500 hover:bg-blue-600 text-white":t.block.config.variant==="primary","bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-white":t.block.config.variant==="secondary","bg-red-500 hover:bg-red-600 text-white":t.block.config.variant==="danger"}])},b(t.block.config.label),11,Xt),t.block.responses?.length?(a(),l("p",Yt,b(t.block.responses.length)+" response(s) ",1)):T("",!0)],64)):t.block.config.type==="input"?(a(),l(R,{key:1},[e("label",Zt,b(t.block.config.label),1),e("div",ea,[W(e("input",{"onUpdate:modelValue":h[1]||(h[1]=_=>k.value=_),type:t.block.config.inputType||"text",placeholder:t.block.config.placeholder,disabled:L.value,class:"flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50",onKeyup:ve(V,["enter"])},null,40,ta),[[$e,k.value]]),e("button",{onClick:V,disabled:L.value||!k.value.trim(),class:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors disabled:opacity-50"},[P(v(le),{class:"w-4 h-4"})],8,aa)]),t.block.responses?.length?(a(),l("div",sa,[(a(!0),l(R,null,E(t.block.responses,(_,r)=>(a(),l("p",{key:r,class:"text-sm text-gray-600 dark:text-gray-400"},[e("span",oa,b(_.responderName||"Peer")+":",1),z(" "+b(_.value),1)]))),128))])):T("",!0)],64)):t.block.config.type==="poll"?(a(),l(R,{key:2},[e("p",na,b(t.block.config.question),1),e("div",la,[(a(!0),l(R,null,E(t.block.config.options,(_,r)=>(a(),l("button",{key:r,onClick:o=>S(r),disabled:L.value,class:j(["w-full text-left px-3 py-2 rounded-lg border transition-colors relative overflow-hidden disabled:cursor-default",w.value.includes(r)?"border-blue-500 bg-blue-50 dark:bg-blue-900/30":"border-gray-300 dark:border-gray-600 hover:border-gray-400"])},[L.value&&I.value[r]?(a(),l("div",{key:0,class:"absolute inset-0 bg-blue-100 dark:bg-blue-900/50 transition-all",style:oe({width:`${I.value[r].percentage}%`})},null,4)):T("",!0),e("span",ia,[e("span",ca,b(_),1),L.value?(a(),l("span",da,b(I.value[r]?.count||0)+" ("+b(Math.round(I.value[r]?.percentage||0))+"%) ",1)):T("",!0)])],10,ra))),128))]),!L.value&&w.value.length>0?(a(),l("button",{key:0,onClick:m,class:"mt-3 w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors"}," Vote ")):T("",!0)],64)):t.block.config.type==="progress"?(a(),l(R,{key:3},[e("div",ua,[e("span",ga,b(t.block.config.label),1),e("span",ba,b(t.block.config.value)+" / "+b(t.block.config.max),1)]),e("div",fa,[e("div",{class:"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500",style:oe({width:`${t.block.config.value/t.block.config.max*100}%`})},null,4)])],64)):t.block.config.type==="confirm"?(a(),l(R,{key:4},[e("p",ya,b(t.block.config.message),1),L.value?(a(),l("p",pa," Response recorded ")):(a(),l("div",va,[e("button",{onClick:h[2]||(h[2]=_=>M(!0)),class:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors"},[P(v(ie),{class:"w-4 h-4"}),z(" "+b(t.block.config.confirmLabel||"Confirm"),1)]),e("button",{onClick:h[3]||(h[3]=_=>M(!1)),class:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-white rounded-lg font-medium transition-colors"},[P(v(ne),{class:"w-4 h-4"}),z(" "+b(t.block.config.cancelLabel||"Cancel"),1)])]))],64)):T("",!0)],2),e("div",{class:j(["mt-1 text-xs text-gray-500",t.block.isLocal?"text-right":"text-left"])},b(x.value),3)],2))}}),ka={class:"system-block w-full flex justify-center my-2"},xa={class:"opacity-60"},ha=N({__name:"SystemBlockView",props:{block:{}},setup(t){const p=t,c=B(()=>{switch(p.block.level){case"success":return ke;case"warning":return Je;case"error":return me;default:return He}}),u=B(()=>{switch(p.block.level){case"success":return"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800";case"warning":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800";case"error":return"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800";default:return"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800"}}),k=B(()=>new Date(p.block.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}));return(w,x)=>(a(),l("div",ka,[e("div",{class:j(["inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-xs border",u.value])},[(a(),D(G(c.value),{class:"w-3.5 h-3.5"})),e("span",null,b(t.block.message),1),e("span",xa,b(k.value),1)],2)]))}}),wa={class:"p2p-terminal h-full flex relative"},Ca={key:0,class:"absolute inset-0 z-0 opacity-15"},$a={class:"relative z-10 w-72 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex flex-col"},_a={class:"p-4 border-b border-gray-200 dark:border-gray-700"},Ta={class:"flex items-center justify-between"},La={class:"font-semibold text-gray-900 dark:text-white flex items-center gap-2"},Sa={class:"flex items-center gap-1"},Ba={key:0,class:"flex-1 flex items-center justify-center"},Pa={key:1,class:"flex-1 overflow-y-auto"},Ua={key:0,class:"p-4 text-center text-gray-500 text-sm"},ja=["onClick"],Ia={class:"flex items-center gap-3"},Da={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-medium"},Ra={class:"flex-1 min-w-0"},Ma={class:"font-medium text-gray-900 dark:text-white truncate"},Va={class:"text-xs text-gray-500 truncate"},Fa={key:0,class:"w-5 h-5 rounded-full bg-blue-500 text-white text-xs flex items-center justify-center"},Wa={class:"relative z-10 flex-1 flex flex-col bg-gray-50 dark:bg-gray-900"},za={key:0,class:"flex-1 flex flex-col items-center justify-center text-gray-500"},Oa={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},Aa={class:"flex items-center gap-3"},Ea={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-medium"},Na={class:"font-semibold text-gray-900 dark:text-white"},Ka={class:"text-xs text-gray-500"},qa={key:0,class:"ml-2 text-blue-500"},Ha=N({__name:"P2PTerminal",setup(t){const{nodeInfo:p,peers:c,isOnline:u,initialize:k}=Pe(),{localNodeId:w,initialize:x,sendTextBlock:L,sendCodeBlock:I,sendFileBlock:F,sendWidgetBlock:V,sendSystemBlock:m,sendTypingIndicator:S,sendWidgetResponse:M}=et(),i=xe(),{isLightningEnabledFor:h,visualEffects:_}=Ue(),r=h("p2p"),o=$(),n=$(!0),f=B(()=>i.activeConversation),y=B(()=>i.activeConversationId&&c.value.find(C=>C.id===i.activeConversationId)||null);_e(async()=>{await k(),p.value&&await x(p.value.nodeId),n.value=!1}),se(()=>f.value?.blocks.length,async()=>{await Se(),U()});function U(){o.value&&(o.value.scrollTop=o.value.scrollHeight)}function O(C){i.createConversation(C),i.setActiveConversation(C.id),m(C.id,`Connected to ${C.name||C.id.slice(0,8)}`,"success")}function H(C,d){i.activeConversationId&&L(i.activeConversationId,C,d)}function J(C,d,s){i.activeConversationId&&I(i.activeConversationId,C,d,s)}function Q(C){i.activeConversationId&&F(i.activeConversationId,C)}function X(C,d){i.activeConversationId&&V(i.activeConversationId,C,d)}function Y(C){i.activeConversationId&&S(i.activeConversationId,C)}function Z(C,d){i.activeConversationId&&M(i.activeConversationId,C,d)}function ee(C){if(C.data){const d=new Blob([C.data],{type:C.mimeType}),s=URL.createObjectURL(d),g=document.createElement("a");g.href=s,g.download=C.filename,g.click(),URL.revokeObjectURL(s)}}return(C,d)=>(a(),l("div",wa,[v(r)?(a(),l("div",Ca,[P(Ze,{hue:200,intensity:v(_).lightning.intensity,speed:v(_).lightning.speed,size:1},null,8,["intensity","speed"])])):T("",!0),e("div",$a,[e("div",_a,[e("div",Ta,[e("h2",La,[P(v(Ge),{class:"w-5 h-5"}),d[0]||(d[0]=z(" Peers ",-1))]),e("div",Sa,[v(u)?(a(),D(v(Qe),{key:0,class:"w-4 h-4 text-green-500"})):(a(),D(v(Xe),{key:1,class:"w-4 h-4 text-red-500"}))])])]),n.value?(a(),l("div",Ba,[P(v(re),{class:"w-6 h-6 text-gray-400 animate-spin"})])):(a(),l("div",Pa,[v(c).length===0?(a(),l("div",Ua," No peers connected ")):T("",!0),(a(!0),l(R,null,E(v(c),s=>(a(),l("button",{key:s.id,onClick:g=>O(s),class:j(["w-full p-4 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-b border-gray-100 dark:border-gray-700",{"bg-blue-50 dark:bg-blue-900/30":v(i).activeConversationId===s.id}])},[e("div",Ia,[e("div",Da,b((s.name||s.id)[0].toUpperCase()),1),e("div",Ra,[e("p",Ma,b(s.name||`Peer ${s.id.slice(0,8)}`),1),e("p",Va,b(s.connectionType)+" â€¢ "+b(s.latencyMs||"?")+"ms ",1)]),v(i).conversations.get(s.id)?.unreadCount?(a(),l("div",Fa,b(v(i).conversations.get(s.id)?.unreadCount),1)):T("",!0)])],10,ja))),128))]))]),e("div",Wa,[f.value?(a(),l(R,{key:1},[e("div",Oa,[e("div",Aa,[e("div",Ea,b((y.value?.name||y.value?.id||"?")[0].toUpperCase()),1),e("div",null,[e("h3",Na,b(y.value?.name||`Peer ${y.value?.id?.slice(0,8)}`),1),e("p",Ka,[z(b(y.value?.connectionType)+" connection ",1),f.value.isTyping?(a(),l("span",qa," typing... ")):T("",!0)])])])]),e("div",{ref_key:"messagesRef",ref:o,class:"flex-1 overflow-y-auto p-6 space-y-4"},[P(Te,{name:"block"},{default:Le(()=>[(a(!0),l(R,null,E(f.value.blocks,s=>(a(),l(R,{key:s.id},[s.type==="text"?(a(),D(St,{key:0,block:s},null,8,["block"])):s.type==="code"?(a(),D(Vt,{key:1,block:s},null,8,["block"])):s.type==="file"?(a(),D(Qt,{key:2,block:s,onDownload:ee},null,8,["block"])):s.type==="widget"?(a(),D(ma,{key:3,block:s,"local-node-id":v(w),onRespond:Z},null,8,["block","local-node-id"])):s.type==="system"?(a(),D(ha,{key:4,block:s},null,8,["block"])):T("",!0)],64))),128))]),_:1})],512),P($t,{onSendText:H,onSendCode:J,onSendFile:Q,onSendWidget:X,onTyping:Y})],64)):(a(),l("div",za,[P(v(Ye),{class:"w-16 h-16 mb-4 opacity-50"}),d[1]||(d[1]=e("p",{class:"text-lg font-medium"},"Select a peer to start chatting",-1)),d[2]||(d[2]=e("p",{class:"text-sm mt-1"},"Choose from the connected peers on the left",-1))]))])]))}}),Ja=je(Ha,[["__scopeId","data-v-bfefde0a"]]),Ga={class:"p2p-terminal-view h-full"},ts=N({__name:"P2PTerminalView",setup(t){return(p,c)=>(a(),l("div",Ga,[P(Ja)]))}});export{ts as default};
