import{a2 as j,k as F,w as K,a as Q,d as _,B as x,D as U,b as V,L as J,E as e,K as u,F as T,N as X,J as m,e as d,c as P,O as z,_ as M,G as I,H as R,P as q,S as re,o as le,A as se,R as ae}from"./vue-vendor-DDhLe2KT.js";import{f as W,l as oe,a as Y,_ as ie,h as ue,i as ce}from"./index-Bx4hJxvb.js";import{x as de,a as ge,b as me,c as ye}from"./xterm-vendor-86Ol6Mvu.js";import{invoke as O}from"@tauri-apps/api/core";import{g as ve,t as be}from"./terminalThemes-B5Ggu4W8.js";import{j as fe,X as Z,T as pe,v as xe,a as ke,J as he,N as Se,O as we,Q as Ce,c as Te,P as Fe}from"./ui-vendor-B_QD22ki.js";import{L as $e}from"./Lightning-C3IqH1GN.js";function Be(){const g=W(),r=j(null),o=j(null),t=j(null),l=F(!1),y=F("");let h=null;async function k(a,c){B();const v=g.settings.terminal;r.value=new de.Terminal({fontFamily:c?.fontFamily||v.fontFamily,fontSize:c?.fontSize||v.fontSize,lineHeight:v.lineHeight,cursorStyle:c?.cursorStyle||v.cursorStyle,cursorBlink:c?.cursorBlink??v.cursorBlink,scrollback:c?.scrollback||v.scrollback,theme:ve(c?.theme||v.theme||"dark"),allowProposedApi:!0}),o.value=new ge.FitAddon,r.value.loadAddon(o.value),t.value=new me.SearchAddon,r.value.loadAddon(t.value);try{const C=new ye.WebglAddon;C.onContextLoss(()=>C.dispose()),r.value.loadAddon(C)}catch{console.warn("WebGL not available, using canvas renderer")}r.value.open(a),o.value.fit(),l.value=!0}async function S(a){if(r.value){y.value=a,r.value.onData(async c=>{try{await O("terminal_input",{sessionId:a,data:c})}catch(v){console.error("Failed to send terminal input:",v)}}),r.value.onResize(async({cols:c,rows:v})=>{try{await O("terminal_resize",{sessionId:a,cols:c,rows:v})}catch(C){console.error("Failed to resize terminal:",C)}}),h=await oe(`terminal-output-${a}`,c=>{r.value?.write(c.payload)});try{await O("terminal_start",{sessionId:a})}catch(c){console.error("Failed to start terminal:",c)}}}function i(a){r.value?.write(a)}function n(){o.value?.fit()}function s(){r.value?.focus()}function w(){r.value?.clear()}function A(){const a=r.value?.getSelection()||"";return a&&navigator.clipboard.writeText(a),a}function D(a){r.value?.paste(a)}function E(a){t.value?.findNext(a)}function $(a){t.value?.findPrevious(a)}function B(){h?.(),h=null,r.value?.dispose(),r.value=null,o.value=null,t.value=null,l.value=!1}return K(()=>g.settings.terminal,a=>{r.value&&(r.value.options.fontFamily=a.fontFamily,r.value.options.fontSize=a.fontSize,r.value.options.lineHeight=a.lineHeight,r.value.options.cursorStyle=a.cursorStyle,r.value.options.cursorBlink=a.cursorBlink,o.value?.fit())},{deep:!0}),Q(B),{terminal:r,isReady:l,initTerminal:k,attachToSession:S,write:i,resize:n,focus:s,clear:w,copySelection:A,paste:D,searchNext:E,searchPrevious:$,destroyTerminal:B}}const ze={class:"text-sm truncate max-w-[120px]"},_e=_({__name:"TerminalTab",props:{id:{},title:{},active:{type:Boolean},hasActivity:{type:Boolean}},emits:["select","close"],setup(g,{emit:r}){const o=r;return(t,l)=>(d(),x("div",{class:U(["terminal-tab flex items-center gap-2 px-3 py-2 cursor-pointer border-b-2 transition-colors",[g.active?"border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white":"border-transparent hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"]]),onClick:l[1]||(l[1]=y=>o("select"))},[g.hasActivity&&!g.active?(d(),V(u(fe),{key:0,class:"w-2 h-2 text-blue-500 fill-current"})):J("",!0),e("span",ze,T(g.title),1),e("button",{onClick:l[0]||(l[0]=X(y=>o("close"),["stop"])),class:"p-0.5 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",title:"Close tab"},[m(u(Z),{class:"w-3.5 h-3.5"})])],2))}}),Ae={class:"terminal-toolbar flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Ee={class:"flex items-center gap-2 px-2 text-sm text-gray-600 dark:text-gray-400"},Le={key:1,class:"font-mono"},Ie=_({__name:"TerminalToolbar",props:{hostname:{},connected:{type:Boolean}},emits:["clear","search","settings","split","copy","export","fullscreen"],setup(g,{emit:r}){const o=g,t=r,{isDecryptedTextEnabled:l}=Y(),y=F(!1),h=P(()=>o.hostname||"Terminal");function k(){y.value=!y.value,t("search")}return(S,i)=>(d(),x("div",Ae,[e("div",Ee,[m(u(pe),{class:"w-4 h-4"}),u(l)&&g.connected?(d(),V(ie,{key:0,text:h.value,speed:30,"max-iterations":8,"animate-on":"view",characters:"01","class-name":"text-green-500 font-mono","encrypted-class-name":"text-gray-500 font-mono"},null,8,["text"])):(d(),x("span",Le,T(h.value),1))]),i[6]||(i[6]=e("div",{class:"w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"},null,-1)),e("button",{onClick:i[0]||(i[0]=n=>t("clear")),class:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",title:"Clear terminal (Ctrl+L)"},[m(u(xe),{class:"w-4 h-4"})]),e("button",{onClick:k,class:U(["p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",{"bg-blue-100 dark:bg-blue-900/30 text-blue-600":y.value}]),title:"Search (Ctrl+F)"},[m(u(ke),{class:"w-4 h-4"})],2),e("button",{onClick:i[1]||(i[1]=n=>t("copy")),class:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",title:"Copy selection (Ctrl+Shift+C)"},[m(u(he),{class:"w-4 h-4"})]),i[7]||(i[7]=e("div",{class:"flex-1"},null,-1)),e("button",{onClick:i[2]||(i[2]=n=>t("split")),class:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",title:"Split terminal"},[m(u(Se),{class:"w-4 h-4"})]),e("button",{onClick:i[3]||(i[3]=n=>t("export")),class:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",title:"Export output"},[m(u(we),{class:"w-4 h-4"})]),e("button",{onClick:i[4]||(i[4]=n=>t("fullscreen")),class:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",title:"Fullscreen (F11)"},[m(u(Ce),{class:"w-4 h-4"})]),e("button",{onClick:i[5]||(i[5]=n=>t("settings")),class:"p-1.5 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",title:"Terminal settings"},[m(u(Te),{class:"w-4 h-4"})])]))}}),Re={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4"},Ue={class:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700"},Pe={class:"p-4 space-y-4"},Ve=["value"],De={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},He=["value"],Ne=["value"],je={class:"flex items-center justify-between"},Me={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},Oe={class:"flex items-center justify-between px-4 py-3 border-t border-gray-200 dark:border-gray-700"},Je={class:"flex gap-2"},We=_({__name:"TerminalSettings",props:{visible:{type:Boolean}},emits:["close","apply"],setup(g,{emit:r}){const o=r,t=W(),l=F({fontFamily:t.settings.terminal.fontFamily,fontSize:t.settings.terminal.fontSize,lineHeight:t.settings.terminal.lineHeight,theme:t.settings.terminal.theme,cursorStyle:t.settings.terminal.cursorStyle,cursorBlink:t.settings.terminal.cursorBlink,scrollback:t.settings.terminal.scrollback,copyOnSelect:t.settings.terminal.copyOnSelect,rightClickPaste:t.settings.terminal.rightClickPaste,bellSound:t.settings.terminal.bellSound}),y=["JetBrains Mono","Fira Code","Source Code Pro","Cascadia Code","Consolas","Monaco","monospace"],h=["block","underline","bar"];function k(){t.updateSettings({terminal:{...l.value}}),o("apply")}function S(){l.value={fontFamily:"JetBrains Mono",fontSize:14,lineHeight:1.2,theme:"dark",cursorStyle:"block",cursorBlink:!0,scrollback:1e4,copyOnSelect:!1,rightClickPaste:!0,bellSound:!1}}return(i,n)=>(d(),V(re,{to:"body"},[g.visible?(d(),x("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:n[8]||(n[8]=X(s=>o("close"),["self"]))},[e("div",Re,[e("div",Ue,[n[9]||(n[9]=e("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"Terminal Settings",-1)),e("button",{onClick:n[0]||(n[0]=s=>o("close")),class:"p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[m(u(Z),{class:"w-5 h-5 text-gray-500"})])]),e("div",Pe,[e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Font Family",-1)),z(e("select",{"onUpdate:modelValue":n[1]||(n[1]=s=>l.value.fontFamily=s),class:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg"},[(d(),x(I,null,R(y,s=>e("option",{key:s,value:s},T(s),9,Ve)),64))],512),[[M,l.value.fontFamily]])]),e("div",null,[e("label",De," Font Size: "+T(l.value.fontSize)+"px ",1),z(e("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>l.value.fontSize=s),type:"range",min:"10",max:"24",class:"w-full"},null,512),[[q,l.value.fontSize,void 0,{number:!0}]])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Theme",-1)),z(e("select",{"onUpdate:modelValue":n[3]||(n[3]=s=>l.value.theme=s),class:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg"},[(d(!0),x(I,null,R(u(be),(s,w)=>(d(),x("option",{key:w,value:w},T(w.charAt(0).toUpperCase()+w.slice(1)),9,He))),128))],512),[[M,l.value.theme]])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Cursor Style",-1)),z(e("select",{"onUpdate:modelValue":n[4]||(n[4]=s=>l.value.cursorStyle=s),class:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-lg"},[(d(),x(I,null,R(h,s=>e("option",{key:s,value:s},T(s.charAt(0).toUpperCase()+s.slice(1)),9,Ne)),64))],512),[[M,l.value.cursorStyle]])]),e("div",je,[n[13]||(n[13]=e("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"Cursor Blink",-1)),e("button",{onClick:n[5]||(n[5]=s=>l.value.cursorBlink=!l.value.cursorBlink),class:U(["relative w-11 h-6 rounded-full transition-colors",l.value.cursorBlink?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"])},[e("span",{class:U(["absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform",{"translate-x-5":l.value.cursorBlink}])},null,2)],2)]),e("div",null,[e("label",Me," Scrollback Lines: "+T(l.value.scrollback.toLocaleString()),1),z(e("input",{"onUpdate:modelValue":n[6]||(n[6]=s=>l.value.scrollback=s),type:"range",min:"1000",max:"100000",step:"1000",class:"w-full"},null,512),[[q,l.value.scrollback,void 0,{number:!0}]])])]),e("div",Oe,[e("button",{onClick:S,class:"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"}," Reset to Defaults "),e("div",Je,[e("button",{onClick:n[7]||(n[7]=s=>o("close")),class:"px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"}," Cancel "),e("button",{onClick:k,class:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"}," Apply ")])])])])):J("",!0)]))}}),Ge={class:"terminal-container flex flex-col h-full bg-gray-900 relative"},qe={key:0,class:"absolute inset-0 z-0 opacity-30"},Ke={class:"relative z-10 flex items-center bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},Qe={class:"flex-1 flex items-center overflow-x-auto"},Xe=_({__name:"TerminalContainer",props:{sessionId:{}},setup(g){const r=g,o=ue(),t=W(),{isLightningEnabledFor:l,visualEffects:y}=Y(),h=l("terminal"),k=F(),S=F(!1),{terminal:i,initTerminal:n,destroyTerminal:s,clear:w,focus:A,copySelection:D}=Be(),E=P(()=>o.activeTab),$=P(()=>o.tabs);K([()=>E.value,k],async([b,f])=>{b&&f&&(await se(),n(f,{fontSize:t.settings.terminal.fontSize,fontFamily:t.settings.terminal.fontFamily,theme:t.settings.terminal.theme,cursorStyle:t.settings.terminal.cursorStyle,cursorBlink:t.settings.terminal.cursorBlink,scrollback:t.settings.terminal.scrollback}))},{immediate:!0}),le(()=>{r.sessionId&&$.value.length===0&&o.createTab(r.sessionId,r.sessionId,"Terminal")}),Q(()=>{s()});function B(){r.sessionId&&o.createTab(r.sessionId,r.sessionId,`Terminal ${$.value.length+1}`)}function a(b){o.closeTab(b)}function c(b){o.setActiveTab(b)}function v(){w()}function C(){D()}function ee(){const b=i.value?.buffer.active;if(b){const f=[];for(let N=0;N<b.length;N++){const G=b.getLine(N);G&&f.push(G.translateToString())}const p=new Blob([f.join(`
`)],{type:"text/plain"}),L=URL.createObjectURL(p),H=document.createElement("a");H.href=L,H.download=`terminal-${Date.now()}.txt`,H.click(),URL.revokeObjectURL(L)}}function te(){const b=k.value?.parentElement;b&&(document.fullscreenElement?document.exitFullscreen():b.requestFullscreen())}function ne(){S.value=!1,k.value&&(s(),n(k.value,{fontSize:t.settings.terminal.fontSize,fontFamily:t.settings.terminal.fontFamily,theme:t.settings.terminal.theme,cursorStyle:t.settings.terminal.cursorStyle,cursorBlink:t.settings.terminal.cursorBlink,scrollback:t.settings.terminal.scrollback}))}return(b,f)=>(d(),x("div",Ge,[u(h)?(d(),x("div",qe,[m($e,{hue:u(y).lightning.hue,intensity:u(y).lightning.intensity,speed:u(y).lightning.speed,size:1},null,8,["hue","intensity","speed"])])):J("",!0),e("div",Ke,[e("div",Qe,[(d(!0),x(I,null,R($.value,p=>(d(),V(_e,{key:p.id,id:p.id,title:p.title,active:p.id===E.value?.id,onSelect:L=>c(p.id),onClose:L=>a(p.id)},null,8,["id","title","active","onSelect","onClose"]))),128))]),e("button",{onClick:B,class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:"New tab"},[m(u(Fe),{class:"w-4 h-4"})])]),m(Ie,{class:"relative z-10",onClear:v,onSearch:()=>{},onSettings:f[0]||(f[0]=p=>S.value=!0),onSplit:()=>{},onCopy:C,onExport:ee,onFullscreen:te}),e("div",{ref_key:"terminalRef",ref:k,class:"flex-1 p-2 relative z-10",onClick:f[1]||(f[1]=(...p)=>u(A)&&u(A)(...p))},null,512),m(We,{visible:S.value,onClose:f[2]||(f[2]=p=>S.value=!1),onApply:ne},null,8,["visible"])]))}}),Ye=ce(Xe,[["__scopeId","data-v-ae51866c"]]),Ze={class:"h-full"},ot=_({__name:"TerminalView",setup(g){const r=ae(),o=P(()=>r.params.sessionId);return(t,l)=>(d(),x("div",Ze,[m(Ye,{"session-id":o.value},null,8,["session-id"])]))}});export{ot as default};
