import{k as u,c as R,a as ae,d as oe,w as H,o as ne,B as x,E as e,L as q,D as he,J as g,K as l,F as S,Q as N,I as W,b as ee,g as te,N as X,e as f,R as we,y as ke,O,P as K}from"./vue-vendor-DDhLe2KT.js";import{invoke as I}from"@tauri-apps/api/core";import{l as Ce}from"./index-Bx4hJxvb.js";import{U as ie,aG as A,a7 as $e,t as _e,aH as ze,aI as Ie,aJ as Se,aK as Pe,ad as se,P as le}from"./ui-vendor-B_QD22ki.js";function re(){const s=u(null),P=u(!1),h=u(!1),v=u(null),T=u(0);let p=null,m=null;const V=R(()=>s.value?.shareLink||""),j=R(()=>s.value?.playback.playing||!1),U=R(()=>s.value?.playback.position||0),J=R(()=>s.value?.playback.speed||1),E=R(()=>s.value?.peers.length||0);async function w(a){h.value=!0,v.value=null;try{const c=await I("stream_create_room",{request:a});return s.value=c,P.value=!0,await t(c.roomId),c}catch(c){throw v.value=String(c),c}finally{h.value=!1}}async function k(a,c){h.value=!0,v.value=null;try{const b=await I("stream_join_room",{roomId:a,hostId:c});return s.value=b,P.value=!1,await t(b.roomId),await d(),b}catch(b){throw v.value=String(b),b}finally{h.value=!1}}async function C(){if(s.value)try{await I("stream_leave_room",{roomId:s.value.roomId})}finally{F(),s.value=null,P.value=!1}}async function $(){s.value&&await I("stream_sync",{request:{roomId:s.value.roomId,eventType:"play",position:s.value.playback.position}})}async function _(){s.value&&await I("stream_sync",{request:{roomId:s.value.roomId,eventType:"pause",position:s.value.playback.position}})}async function n(a){s.value&&await I("stream_sync",{request:{roomId:s.value.roomId,eventType:"seek",position:a}})}async function M(a){s.value&&await I("stream_sync",{request:{roomId:s.value.roomId,eventType:"speed",speed:a}})}async function L(a){s.value&&await I("stream_update_position",{roomId:s.value.roomId,position:a})}async function z(){return s.value?await I("stream_get_expected_position",{roomId:s.value.roomId}):0}async function d(){if(!s.value)return;const a=await I("stream_get_room",{roomId:s.value.roomId});s.value=a}async function t(a){p=await Ce(`stream-event-${a}`,c=>{r(c.payload)}),m=setInterval(async()=>{if(s.value?.playback.playing){const c=await z();T.value=c-(s.value?.playback.position||0)}},5e3)}function r(a){if(s.value)switch(a.type){case"play":s.value.playback.playing=!0,a.position!==void 0&&(s.value.playback.position=a.position);break;case"pause":s.value.playback.playing=!1,a.position!==void 0&&(s.value.playback.position=a.position);break;case"seek":a.position!==void 0&&(s.value.playback.position=a.position);break;case"speed":a.speed!==void 0&&(s.value.playback.speed=a.speed);break;case"peerJoined":a.peerId&&!s.value.peers.includes(a.peerId)&&s.value.peers.push(a.peerId);break;case"peerLeft":a.peerId&&(s.value.peers=s.value.peers.filter(c=>c!==a.peerId));break;case"stateSync":a.state&&(s.value.playback=a.state);break}}function F(){p?.(),p=null,m&&(clearInterval(m),m=null)}return ae(()=>{F()}),{room:s,isHost:P,isLoading:h,error:v,shareLink:V,isPlaying:j,currentPosition:U,playbackSpeed:J,peerCount:E,syncOffset:T,createRoom:w,joinRoom:k,leaveRoom:C,play:$,pause:_,seek:n,setSpeed:M,updatePosition:L,getExpectedPosition:z,requestSync:d}}const Te=["src"],Le={class:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between"},Re={class:"flex items-center gap-2"},Me={class:"text-white/80 text-sm"},Ve={class:"px-4 mb-2"},je={class:"px-4 pb-4 flex items-center gap-4"},Ue={class:"flex items-center gap-2"},Je=["value"],qe={class:"text-white text-sm"},Ee={key:0,class:"text-yellow-400 text-xs"},Fe=["value"],Ne={class:"bg-zinc-900 rounded-lg p-6 max-w-md w-full mx-4"},De={class:"flex gap-2"},Be=["value"],He=oe({__name:"SyncVideoPlayer",props:{source:{},roomId:{}},emits:["timeUpdate","ended"],setup(s,{emit:P}){const h=P,{room:v,isHost:T,isPlaying:p,currentPosition:m,playbackSpeed:V,peerCount:j,shareLink:U,syncOffset:J,play:E,pause:w,seek:k,setSpeed:C,updatePosition:$,getExpectedPosition:_}=re(),n=u(null),M=u(null),L=u(1),z=u(!1),d=u(!1),t=u(!0),r=u(0),F=u(0),a=u(!1),c=u(!1);let b=null,D=null;const ue=R(()=>v.value?.source&&v.value.source.type==="url"?v.value.source.url:""),ce=R(()=>{const i=m.value,o=r.value;return`${Q(i)} / ${Q(o)}`}),G=R(()=>r.value===0?0:m.value/r.value*100);function Q(i){const o=Math.floor(i/3600),y=Math.floor(i%3600/60),B=Math.floor(i%60);return o>0?`${o}:${y.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`:`${y}:${B.toString().padStart(2,"0")}`}async function Y(){p.value?(await w(),n.value?.pause()):(await E(),n.value?.play())}async function de(i){const y=i.currentTarget.getBoundingClientRect(),Z=(i.clientX-y.left)/y.width*r.value;await k(Z),n.value&&(n.value.currentTime=Z)}function ve(i){const o=i.target;L.value=parseFloat(o.value),n.value&&(n.value.volume=L.value),z.value=L.value===0}function pe(){z.value=!z.value,n.value&&(n.value.muted=z.value)}async function fe(){M.value&&(document.fullscreenElement?(await document.exitFullscreen(),d.value=!1):(await M.value.requestFullscreen(),d.value=!0))}function me(){t.value=!0,b&&clearTimeout(b),b=setTimeout(()=>{p.value&&(t.value=!1)},3e3)}function be(){if(!n.value)return;const i=n.value.currentTime;$(i),h("timeUpdate",i)}function ye(){n.value&&(r.value=n.value.duration)}function ge(){if(!n.value)return;const i=n.value.buffered;i.length>0&&(F.value=i.end(i.length-1)/r.value*100)}async function xe(){await navigator.clipboard.writeText(U.value),c.value=!0,setTimeout(()=>{c.value=!1},2e3)}return H(p,i=>{n.value&&(i&&n.value.paused?n.value.play():!i&&!n.value.paused&&n.value.pause())}),H(m,i=>{if(!n.value||T.value)return;Math.abs(n.value.currentTime-i)>2&&(n.value.currentTime=i)}),H(V,i=>{n.value&&(n.value.playbackRate=i)}),ne(()=>{T.value||(D=setInterval(async()=>{if(!n.value||!p.value)return;const i=await _();Math.abs(n.value.currentTime-i)>1&&(n.value.currentTime=i)},5e3))}),ae(()=>{b&&clearTimeout(b),D&&clearInterval(D)}),(i,o)=>(f(),x("div",{ref_key:"containerRef",ref:M,class:"relative bg-black rounded-lg overflow-hidden group",onMousemove:me,onMouseleave:o[5]||(o[5]=y=>t.value=!1)},[e("video",{ref_key:"videoRef",ref:n,class:"w-full h-full",src:ue.value,onTimeupdate:be,onLoadedmetadata:ye,onProgress:ge,onEnded:o[0]||(o[0]=y=>h("ended")),onClick:Y},null,40,Te),e("div",{class:he(["absolute inset-0 flex flex-col justify-end transition-opacity duration-300",t.value?"opacity-100":"opacity-0"])},[o[9]||(o[9]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent pointer-events-none"},null,-1)),e("div",Le,[e("div",Re,[g(l(ie),{class:"w-4 h-4 text-white/80"}),e("span",Me,S(l(j)+1)+" watching",1)]),l(T)?(f(),x("button",{key:0,class:"flex items-center gap-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded-full text-white text-sm transition-colors",onClick:o[1]||(o[1]=y=>a.value=!0)},[g(l(A),{class:"w-4 h-4"}),o[6]||(o[6]=N(" Share ",-1))])):q("",!0)]),e("div",Ve,[e("div",{class:"relative h-1 bg-white/20 rounded-full cursor-pointer group/progress",onClick:de},[e("div",{class:"absolute h-full bg-white/30 rounded-full",style:W({width:`${F.value}%`})},null,4),e("div",{class:"absolute h-full bg-blue-500 rounded-full",style:W({width:`${G.value}%`})},null,4),e("div",{class:"absolute h-3 w-3 bg-blue-500 rounded-full -top-1 transform -translate-x-1/2 opacity-0 group-hover/progress:opacity-100 transition-opacity",style:W({left:`${G.value}%`})},null,4)])]),e("div",je,[e("button",{class:"p-2 hover:bg-white/10 rounded-full transition-colors",onClick:Y},[(f(),ee(te(l(p)?l($e):l(_e)),{class:"w-6 h-6 text-white"}))]),e("div",Ue,[e("button",{class:"p-2 hover:bg-white/10 rounded-full transition-colors",onClick:pe},[(f(),ee(te(z.value?l(ze):l(Ie)),{class:"w-5 h-5 text-white"}))]),e("input",{type:"range",min:"0",max:"1",step:"0.1",value:L.value,class:"w-20 accent-blue-500",onInput:ve},null,40,Je)]),e("span",qe,S(ce.value),1),o[8]||(o[8]=e("div",{class:"flex-1"},null,-1)),Math.abs(l(J))>.5?(f(),x("div",Ee," Syncing... ")):q("",!0),e("select",{value:l(V),class:"bg-transparent text-white text-sm border border-white/20 rounded px-2 py-1",onChange:o[2]||(o[2]=y=>l(C)(parseFloat(y.target.value)))},[...o[7]||(o[7]=[e("option",{value:"0.5"},"0.5x",-1),e("option",{value:"1"},"1x",-1),e("option",{value:"1.5"},"1.5x",-1),e("option",{value:"2"},"2x",-1)])],40,Fe),e("button",{class:"p-2 hover:bg-white/10 rounded-full transition-colors",onClick:fe},[g(l(Se),{class:"w-5 h-5 text-white"})])])],2),a.value?(f(),x("div",{key:0,class:"absolute inset-0 bg-black/80 flex items-center justify-center",onClick:o[4]||(o[4]=X(y=>a.value=!1,["self"]))},[e("div",Ne,[o[10]||(o[10]=e("h3",{class:"text-white text-lg font-semibold mb-4"},"Share Watch Party",-1)),o[11]||(o[11]=e("p",{class:"text-zinc-400 text-sm mb-4"}," Share this link with friends to watch together in sync: ",-1)),e("div",De,[e("input",{type:"text",value:l(U),readonly:"",class:"flex-1 bg-zinc-800 text-white px-3 py-2 rounded text-sm"},null,8,Be),e("button",{class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm transition-colors",onClick:xe},S(c.value?"Copied!":"Copy"),1)]),e("button",{class:"mt-4 w-full py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded text-sm transition-colors",onClick:o[3]||(o[3]=y=>a.value=!1)}," Close ")])])):q("",!0)],544))}}),We={class:"min-h-screen bg-zinc-950 text-white"},Oe={class:"border-b border-zinc-800 px-6 py-4"},Ke={class:"flex items-center justify-between"},Xe={class:"flex items-center gap-4"},Ae={class:"flex items-center gap-2"},Ge={key:0,class:"flex items-center gap-3"},Qe={key:1,class:"flex items-center gap-4"},Ye={class:"flex items-center gap-2 text-zinc-400"},Ze={class:"p-6"},et={key:0,class:"flex flex-col items-center justify-center min-h-[60vh] text-center"},tt={class:"flex gap-3"},st={key:1,class:"max-w-6xl mx-auto"},lt={class:"mb-4"},at={class:"text-xl font-semibold"},ot={class:"text-zinc-400 text-sm"},nt={class:"aspect-video bg-zinc-900 rounded-lg overflow-hidden"},it={class:"mt-4 p-4 bg-zinc-900 rounded-lg"},rt={class:"flex items-center justify-between"},ut={class:"text-sm font-mono text-zinc-300 truncate max-w-md"},ct={class:"bg-zinc-900 rounded-lg p-6 max-w-md w-full mx-4"},dt={class:"space-y-4"},vt={class:"flex gap-3 mt-6"},pt=["disabled"],ft={class:"bg-zinc-900 rounded-lg p-6 max-w-md w-full mx-4"},mt={key:0,class:"text-red-400 text-sm mt-2"},bt={class:"flex gap-3 mt-6"},yt=["disabled"],kt=oe({__name:"StreamingView",setup(s){const P=we(),h=ke(),{room:v,isHost:T,isLoading:p,error:m,peerCount:V,shareLink:j,createRoom:U,joinRoom:J,leaveRoom:E}=re(),w=u(!1),k=u(!1),C=u(""),$=u(""),_=u("");function n(d){navigator.clipboard.writeText(d)}async function M(){if(!C.value||!$.value)return;const d={name:C.value,sourceType:"url",url:$.value};await U(d),w.value=!1,C.value="",$.value=""}async function L(){if(!_.value)return;const d=_.value.match(/russh:\/\/stream\/([^?]+)\?host=(.+)/);if(!d){m.value="Invalid share link";return}const[,t,r]=d;await J(t,r),k.value=!1,_.value=""}async function z(){await E()}return ne(()=>{const d=P.query.room,t=P.query.host;d&&t&&J(d,t)}),(d,t)=>(f(),x("div",We,[e("header",Oe,[e("div",Ke,[e("div",Xe,[e("button",{class:"p-2 hover:bg-zinc-800 rounded-lg transition-colors",onClick:t[0]||(t[0]=r=>l(h).back())},[g(l(Pe),{class:"w-5 h-5"})]),e("div",Ae,[g(l(se),{class:"w-6 h-6 text-blue-500"}),t[13]||(t[13]=e("h1",{class:"text-xl font-semibold"},"Watch Party",-1))])]),l(v)?(f(),x("div",Qe,[e("div",Ye,[g(l(ie),{class:"w-4 h-4"}),e("span",null,S(l(V)+1)+" watching",1)]),e("button",{class:"px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg transition-colors",onClick:z}," Leave Party ")])):(f(),x("div",Ge,[e("button",{class:"flex items-center gap-2 px-4 py-2 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",onClick:t[1]||(t[1]=r=>k.value=!0)},[g(l(A),{class:"w-4 h-4"}),t[14]||(t[14]=N(" Join Party ",-1))]),e("button",{class:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",onClick:t[2]||(t[2]=r=>w.value=!0)},[g(l(le),{class:"w-4 h-4"}),t[15]||(t[15]=N(" Create Party ",-1))])]))])]),e("main",Ze,[l(v)?(f(),x("div",st,[e("div",lt,[e("h2",at,S(l(v).name),1),e("p",ot,S(l(T)?"You are the host":`Hosted by ${l(v).hostId.slice(0,8)}...`),1)]),e("div",nt,[g(He)]),e("div",it,[e("div",rt,[e("div",null,[t[20]||(t[20]=e("p",{class:"text-sm text-zinc-400"},"Share Link",-1)),e("p",ut,S(l(j)),1)]),e("button",{class:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 rounded-lg text-sm transition-colors",onClick:t[5]||(t[5]=r=>n(l(j)))}," Copy Link ")])])])):(f(),x("div",et,[g(l(se),{class:"w-16 h-16 text-zinc-700 mb-4"}),t[18]||(t[18]=e("h2",{class:"text-2xl font-semibold mb-2"},"Watch Together",-1)),t[19]||(t[19]=e("p",{class:"text-zinc-400 max-w-md mb-6"}," Create a watch party to stream videos with friends in perfect sync. Share a link and everyone watches together! ",-1)),e("div",tt,[e("button",{class:"flex items-center gap-2 px-6 py-3 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",onClick:t[3]||(t[3]=r=>k.value=!0)},[g(l(A),{class:"w-5 h-5"}),t[16]||(t[16]=N(" Join with Link ",-1))]),e("button",{class:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",onClick:t[4]||(t[4]=r=>w.value=!0)},[g(l(le),{class:"w-5 h-5"}),t[17]||(t[17]=N(" Create Party ",-1))])])]))]),w.value?(f(),x("div",{key:0,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:t[9]||(t[9]=X(r=>w.value=!1,["self"]))},[e("div",ct,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold mb-4"},"Create Watch Party",-1)),e("div",dt,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-zinc-400 mb-1"},"Party Name",-1)),O(e("input",{"onUpdate:modelValue":t[6]||(t[6]=r=>C.value=r),type:"text",placeholder:"Movie Night",class:"w-full bg-zinc-800 text-white px-3 py-2 rounded-lg"},null,512),[[K,C.value]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm text-zinc-400 mb-1"},"Video URL",-1)),O(e("input",{"onUpdate:modelValue":t[7]||(t[7]=r=>$.value=r),type:"url",placeholder:"https://example.com/video.mp4",class:"w-full bg-zinc-800 text-white px-3 py-2 rounded-lg"},null,512),[[K,$.value]])])]),e("div",vt,[e("button",{class:"flex-1 py-2 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",onClick:t[8]||(t[8]=r=>w.value=!1)}," Cancel "),e("button",{class:"flex-1 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",disabled:l(p)||!C.value||!$.value,onClick:M},S(l(p)?"Creating...":"Create"),9,pt)])])])):q("",!0),k.value?(f(),x("div",{key:1,class:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",onClick:t[12]||(t[12]=X(r=>k.value=!1,["self"]))},[e("div",ft,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold mb-4"},"Join Watch Party",-1)),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm text-zinc-400 mb-1"},"Share Link",-1)),O(e("input",{"onUpdate:modelValue":t[10]||(t[10]=r=>_.value=r),type:"text",placeholder:"russh://stream/...",class:"w-full bg-zinc-800 text-white px-3 py-2 rounded-lg"},null,512),[[K,_.value]])]),l(m)?(f(),x("p",mt,S(l(m)),1)):q("",!0),e("div",bt,[e("button",{class:"flex-1 py-2 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",onClick:t[11]||(t[11]=r=>k.value=!1)}," Cancel "),e("button",{class:"flex-1 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",disabled:l(p)||!_.value,onClick:L},S(l(p)?"Joining...":"Join"),9,yt)])])])):q("",!0)]))}});export{kt as default};
